From: Michael Stapelberg <michael@stapelberg.de>
Date: Thu, 8 Aug 2013 15:50:41 -0400
Subject: =?utf-8?q?Don=E2=80=99t_mount_/tmp_as_tmpfs_by_default?=
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: 8bit

…by adding an [Install] section to tmp.mount and removing the
local-fs.target.wants symlink.

Users can use “systemctl enable tmp.mount” to enable mounting /tmp after
the next reboot and “systemctl start tmp.mount” to get /tmp mounted as
tmpfs right now (beware, files currently in /tmp will not be visible
anymore afterwards).
---
 Makefile.am        | 1 -
 units/basic.target | 2 +-
 units/tmp.mount    | 3 +++
 3 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/Makefile.am b/Makefile.am
index 89d94a0..89b7d12 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -6686,7 +6686,6 @@ SYSINIT_TARGET_WANTS += \
 
 LOCAL_FS_TARGET_WANTS += \
 	systemd-remount-fs.service \
-	tmp.mount \
 	var-lib-machines.mount
 
 MULTI_USER_TARGET_WANTS += \
diff --git a/units/basic.target b/units/basic.target
index e0e1e60..9fa8c9c 100644
--- a/units/basic.target
+++ b/units/basic.target
@@ -14,4 +14,4 @@ After=sysinit.target sockets.target paths.target slices.target
 
 # We support /var, /tmp, /var/tmp, being on NFS, but we don't pull in
 # remote-fs.target by default, hence explicitly pull /var in here.
-RequiresMountsFor=/var /tmp /var/tmp
+RequiresMountsFor=/var /var/tmp
diff --git a/units/tmp.mount b/units/tmp.mount
index 00a0d28..8777171 100644
--- a/units/tmp.mount
+++ b/units/tmp.mount
@@ -19,3 +19,6 @@ What=tmpfs
 Where=/tmp
 Type=tmpfs
 Options=mode=1777,strictatime
+
+[Install]
+WantedBy=local-fs.target
