From: Lennart Poettering <lennart@poettering.net>
Date: Tue, 25 Mar 2014 00:01:51 +0100
Subject: sd-event: don't accidentally turn of watchdog timer event if we
 determine 0

(cherry picked from commit 75145780813957ecbe6835f2c8bc20113a3605d2)
---
 src/libsystemd/sd-event/sd-event.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/libsystemd/sd-event/sd-event.c b/src/libsystemd/sd-event/sd-event.c
index 4f4d1772..fdf4d12e 100644
--- a/src/libsystemd/sd-event/sd-event.c
+++ b/src/libsystemd/sd-event/sd-event.c
@@ -2015,6 +2015,11 @@ static int arm_watchdog(sd_event *e) {
 
         timespec_store(&its.it_value, t);
 
+        /* Make sure we never set the watchdog to 0, which tells the
+         * kernel to disable it. */
+        if (its.it_value.tv_sec == 0 && its.it_value.tv_nsec == 0)
+                its.it_value.tv_nsec = 1;
+
         r = timerfd_settime(e->watchdog_fd, TFD_TIMER_ABSTIME, &its, NULL);
         if (r < 0)
                 return -errno;
